project_name: "cannibalization_retail"
log_level: "INFO"
fail_fast: false

toggles:
  step1: true
  step2: true
  step3: true
  step4: true
  eda1: true
  eda2: true
  eda3: true
  eda4: true
  step5_gsc: true
  step6_meta: true
  eda_algorithms: true
  # Cache control - reutilizar outputs si existen (ahorra tiempo)
  use_cached_step1: true  # Reutilizar train_filtered.csv si existe
  use_cached_step2: true  # Reutilizar competitive_exposure.csv si existe
  use_cached_step3: true  # Reutilizar pairs_windows.csv y donors si existen

paths:
  raw_dir: ".data/raw_data"
  train_csv: ".data/processed_data/train_filtered.csv"     # si Step 1 produce estos, puedes apuntar directo
  transactions_csv: ".data/processed_data/transactions_filtered.csv"
  items_csv: ".data/raw_data/items.csv"
  stores_csv: ".data/raw_data/stores.csv"
  processed_dir: ".data/processed_data"
  preprocessed_dir: ".data/processed_data"
  figures_dir: "figures"
  exposure_csv: ".data/processed_data/competitive_exposure.csv"
  gsc_out_dir: ".data/processed_data"
  meta_out_root: ".data/processed_data/meta_outputs"

params:
  gsc_eval_n: 10
  gsc_eval_selection: "head"
  # Step 4 (pre_algorithm)
  
  top_k_donors: 10
  donor_kind: "same_item"
  lags_days: [7, 14, 28, 56]
  fourier_k: 3
  max_donor_promo_share: 0.02
  min_availability_share: 0.90
  max_episodes: null  # null = sin límite, procesa todos los disponibles

  # Algoritmo GSC
  gsc_log_level: "INFO"
  gsc_max_episodes: null  # null = sin límite, procesa todos
  gsc_cv_folds: 3
  gsc_cv_holdout: 21
  gsc_do_placebo_space: true
  gsc_do_placebo_time: true
  gsc_do_loo: false
  gsc_max_loo: 5
  gsc_sens_samples: 0
  gsc_rank: 5
  gsc_tau: 0.0001
  gsc_alpha: 0.0

  # Meta‑learners
  meta_learners: ["x"]      # o ["t","s","x"]
  meta_model: "hgbt"
  meta_prop_model: "logit"
  meta_random_state: 42
  meta_cv_folds: 3
  meta_cv_holdout: 21
  meta_min_train_samples: 50
  meta_max_episodes: null  # null = sin límite, procesa todos
  meta_do_placebo_space: true
  meta_do_placebo_time: true
  meta_do_loo: false
  meta_max_loo: 5
  meta_sens_samples: 0
  meta_max_depth: 6
  meta_learning_rate: 0.05
  meta_max_iter: 500
  meta_min_samples_leaf: 20
  meta_l2: 0.0
  meta_hpo_trials: 100  # Número de trials de Optuna para HPO
  treat_col_s: "H_disc"
  s_ref: 0.0
  treat_col_b: "H_prop"
  bin_threshold: 0.0

  # EDA final de algoritmos
  eda_alg_orientation: "landscape"
  eda_alg_dpi: 300
  eda_alg_learners: ["t", "s", "x"]   # cuáles comparar/visualizar
  eda_alg_export_pdf: true
  eda_alg_max_episodes_gsc: null   # null = sin límite, plotea todos
  eda_alg_max_episodes_meta: null  # null = sin límite, plotea todos

